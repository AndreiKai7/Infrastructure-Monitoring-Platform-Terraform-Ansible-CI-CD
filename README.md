# üöÄ Infrastructure Monitoring Platform

![Terraform](https://img.shields.io/badge/Terraform-1.4.6-blueviolet)
![Ansible](https://img.shields.io/badge/Ansible-2.9%2B-red)
![Yandex Cloud](https://img.shields.io/badge/Yandex_Cloud-Gold)
![CI/CD](https://img.shields.io/badge/CI%2FCD-Passing-brightgreen)

> –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞ –±–∞–∑–µ **Prometheus** –∏ **Grafana** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Terraform** –∏ **Ansible**.

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Ö–æ–¥ **Infrastructure as Code (IaC)**, —Å–æ–±–ª—é–¥–∞—è best practices –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–∞–º—ã–∫–∞–Ω–∏—è Prometheus –Ω–∞ `localhost`, —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π, —Å–µ–∫—Ä–µ—Ç—ã –≤–Ω–µ –∫–æ–¥–∞).

---

## üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ –º–æ–¥—É–ª—å–Ω–æ–º—É –ø—Ä–∏–Ω—Ü–∏–ø—É:
1.  **Monitoring Server**: –°–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ.
2.  **Client Server**: –û—Ç–¥–∞–µ—Ç —Å–≤–æ–∏ –º–µ—Ç—Ä–∏–∫–∏ (CPU, RAM, Disk) —á–µ—Ä–µ–∑ `node_exporter`.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Monitoring Server (VM)    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ    Prometheus      ‚îÇ   ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ (Pull Metrics) ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚îÇ    Port: 127.0.0.1:9090‚îÇ ‚îÇ                        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ                        ‚îÇ
‚îÇ  ‚îÇ      Grafana        ‚îÇ   ‚îÇ                        ‚îÇ
‚îÇ  ‚îÇ    Port: 3000       ‚îÇ   ‚îÇ                        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îÇ
                    ‚Üë                                 ‚îÇ
                    ‚îÇ  –î–∞–Ω–Ω—ã–µ (Dashboard)             ‚îÇ
                    ‚îÇ                                 ‚îÇ
                  User                               ‚îÇ
                                                       ‚ñº
                                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                    ‚îÇ   Client Server (VM)      ‚îÇ
                                    ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
                                    ‚îÇ  ‚îÇ   Node Exporter    ‚îÇ   ‚îÇ
                                    ‚îÇ  ‚îÇ   Port: 9100       ‚îÇ   ‚îÇ
                                    ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| :--- | :--- |
| **Terraform** | –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ Yandex Cloud (VPC, VM, Security Groups). |
| **Ansible** | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ñ—Ç–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö. |
| **Docker** | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è Prometheus –∏ Grafana. |
| **Node Exporter** | –ê–≥–µ–Ω—Ç –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ Linux. |

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ:
*   [Terraform](https://learn.hashicorp.com/tutorials/terraform/install-cli) (>= 1.4)
*   [Ansible](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html) (>= 2.9)
*   [Yandex Cloud CLI](https://cloud.yandex.ru/ru/docs/cli/quickstart) (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞)
*   SSH-–∫–ª—é—á–∏ (`id_ed25519` –∏–ª–∏ `id_rsa`)

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Terraform Mirror (–í–∞–∂–Ω–æ –¥–ª—è –†–§)

–ß—Ç–æ–±—ã Terraform –º–æ–≥ —Å–∫–∞—á–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏–∑ –†–æ—Å—Å–∏–∏, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∑–µ—Ä–∫–∞–ª–∞:

```bash
nano ~/.terraformrc
```

–í—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ (`Ctrl+O`, `Enter`, `Ctrl+X`):

```hcl
provider_installation {
  network_mirror {
    url = "https://terraform-mirror.yandexcloud.net/"
    include = ["registry.terraform.io/*/*"]
  }
  direct {
    exclude = ["registry.terraform.io/*/*"]
  }
}
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Yandex Cloud CLI –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –≤ –æ–±–ª–∞–∫–µ –∏ —Å–æ–∑–¥–∞–π—Ç–µ OAuth —Ç–æ–∫–µ–Ω (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ, –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Service Account):

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Yandex CLI (–ø–æ—Ç—Ä–µ–±—É–µ—Ç –±—Ä–∞—É–∑–µ—Ä)
yc init

# –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
export YC_TOKEN=$(yc iam create-token)
```

### 4. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Terraform)

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É —Å Terraform –∏ —Å–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```bash
cd terraform

# –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã
echo $YC_TOKEN # –î–æ–ª–∂–µ–Ω –≤—ã–≤–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–µ—Ä–∫–∞–ª–æ)
terraform init

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞–Ω–∞
terraform plan

# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
terraform apply
```
*–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Terraform –≤—ã–≤–µ–¥–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–µ IP –∞–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤. –ó–∞–ø–∏—à–∏—Ç–µ –∏—Ö!*

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Ansible Inventory

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ IP –∞–¥—Ä–µ—Å–∞:

```bash
cd ../ansible
cp inventory.ini.example inventory.ini
nano inventory.ini
```

–ü—Ä–∏–º–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è (–∑–∞–º–µ–Ω–∏—Ç–µ IP –Ω–∞ —Å–≤–æ–∏):
```ini
[monitoring]
monitoring-server ansible_host=1.2.3.4

[monitoring:vars]
grafana_admin_user=admin
grafana_admin_password=super_secret

[clients]
client-server ansible_host=1.2.3.5

[all:vars]
ansible_python_interpreter=/usr/bin/python3
```

### 6. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (Ansible)

Ansible –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç Docker, Node Exporter, Prometheus –∏ Grafana.

```bash
ansible-playbook -i inventory.ini playbook.yml
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Ansible:

1.  **Grafana**: –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ `http://<MONITORING_IP>:3000`.
    *   –õ–æ–≥–∏–Ω/–ü–∞—Ä–æ–ª—å: —Ç–æ—Ç, —á—Ç–æ –≤—ã —É–∫–∞–∑–∞–ª–∏ –≤ `inventory.ini` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `admin` / `super_secret_password_123`).
    *   **Datasource**: Grafana –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ Prometheus –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
2.  **Prometheus UI**: –î–æ—Å—Ç—É–ø–µ–Ω –ø–æ `http://localhost:9090` (–µ—Å–ª–∏ –≤—ã –Ω–∞ —Å–∞–º–æ–º —Å–µ—Ä–≤–µ—Ä–µ) –∏–ª–∏ —á–µ—Ä–µ–∑ SSH-—Ç—É–Ω–Ω–µ–ª—å. –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ –∑–∞–∫—Ä—ã—Ç –ø–æ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (bind to 127.0.0.1).

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ .github/                 # GitHub Actions CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îú‚îÄ‚îÄ ansible/                 # Ansible –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ roles/               # –†–æ–ª–∏ (client, monitoring)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client/          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Node Exporter –∏ Docker
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ monitoring/      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Prometheus –∏ Grafana
‚îÇ   ‚îú‚îÄ‚îÄ ansible.cfg          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Ansible
‚îÇ   ‚îú‚îÄ‚îÄ inventory.ini        # –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å–µ—Ä–≤–µ—Ä–æ–≤ (IP –∞–¥—Ä–µ—Å–∞)
‚îÇ   ‚îî‚îÄ‚îÄ playbook.yml         # –ì–ª–∞–≤–Ω—ã–π –ø–ª–µ–π–±—É–∫
‚îú‚îÄ‚îÄ terraform/               # –ö–æ–¥ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ main.tf              # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥
‚îÇ   ‚îú‚îÄ‚îÄ outputs.tf           # –í—ã—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (IP)
‚îÇ   ‚îú‚îÄ‚îÄ provider.tf          # –ü—Ä–æ–≤–∞–π–¥–µ—Ä Yandex Cloud
‚îÇ   ‚îî‚îÄ‚îÄ variables.tf         # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
‚îî‚îÄ‚îÄ README.md
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1.  **–°–µ–∫—Ä–µ—Ç—ã**: `.env` –∏ `inventory.ini` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `.gitignore` –∏ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
2.  **SSH**: –î–æ—Å—Ç—É–ø –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª—é—á–∞–º.
3.  **Network**: Prometheus —Å–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ `127.0.0.1` (localhost), —á—Ç–æ–±—ã –Ω–µ exposing –º–µ—Ç—Ä–∏–∫–∏ –≤–æ –≤–Ω–µ—à–Ω–∏–π –º–∏—Ä. –î–æ—Å—Ç—É–ø –∫ Grafana –æ–≥—Ä–∞–Ω–∏—á–µ–Ω —Ñ–∞–π—Ä–≤–æ–ª–æ–º (–ø–æ—Ä—Ç 3000).

