# ๐ Infrastructure Monitoring Platform

![Terraform](https://img.shields.io/badge/Terraform-blueviolet)
![Ansible](https://img.shields.io/badge/Ansible-red)
![Yandex Cloud](https://img.shields.io/badge/Yandex_Cloud-Gold)
![CI/CD](https://img.shields.io/badge/CI%2FCD-Passing-brightgreen)

> ะะพะปะฝะพัััั ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝะพะต ัะฐะทะฒะตัััะฒะฐะฝะธะต ัะธััะตะผั ะผะพะฝะธัะพัะธะฝะณะฐ ะฝะฐ ะฑะฐะทะต **Prometheus** ะธ **Grafana** ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ **Terraform** ะธ **Ansible**.

ะญัะพั ะฟัะพะตะบั ะดะตะผะพะฝัััะธััะตั ะฟะพะดัะพะด **Infrastructure as Code (IaC)**, ัะพะฑะปัะดะฐั best practices ะฑะตะทะพะฟะฐัะฝะพััะธ (ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะทะฐะผัะบะฐะฝะธั Prometheus ะฝะฐ `localhost`, ัะฐะทะดะตะปะตะฝะธะต ัะพะปะตะน, ัะตะบัะตัั ะฒะฝะต ะบะพะดะฐ).

---

## ๐ ะััะธัะตะบัััะฐ

ะกะธััะตะผะฐ ะฟะพัััะพะตะฝะฐ ะฟะพ ะผะพะดัะปัะฝะพะผั ะฟัะธะฝัะธะฟั:
1.  **Monitoring Server**: ะกะพะฑะธัะฐะตั ะผะตััะธะบะธ ะธ ะฒะธะทัะฐะปะธะทะธััะตั ะดะฐะฝะฝัะต.
2.  **Client Server**: ะัะดะฐะตั ัะฒะพะธ ะผะตััะธะบะธ (CPU, RAM, Disk) ัะตัะตะท `node_exporter`.

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Monitoring Server (VM)    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ    Prometheus       โ    โ โโโโ (Pull Metrics) โโโโโ
โ  โ Port: 127.0.0.1:9090โ    โ                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโ    โ                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโ    โ                         โ
โ  โ      Grafana        โ    โ                         โ
โ  โ    Port: 3000       โ    โ                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโ    โ                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                         โ
                    โ                                   โ
                    โ  ะะฐะฝะฝัะต (Dashboard)               โ
                    โ                                   โ
                  User                                  โ
                                                        โผ
                                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                    โ   Client Server (VM)     โ
                                    โ  โโโโโโโโโโโโโโโโโโโโโโ  โ
                                    โ  โ   Node Exporter    โ  โ
                                    โ  โ   Port: 9100       โ  โ
                                    โ  โโโโโโโโโโโโโโโโโโโโโโ  โ
                                    โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

| ะะฝััััะผะตะฝั | ะะฐะทะฝะฐัะตะฝะธะต |
| :--- | :--- |
| **Terraform** | ะกะพะทะดะฐะฝะธะต ะธะฝััะฐััััะบัััั ะฒ Yandex Cloud (VPC, VM, Security Groups). |
| **Ansible** | ะฃััะฐะฝะพะฒะบะฐ ัะพััะฐ ะธ ะฝะฐัััะพะนะบะฐ ะบะพะฝัะธะณััะฐัะธะน ะฝะฐ ัะตัะฒะตัะฐั. |
| **Docker** | ะะพะฝัะตะนะฝะตัะธะทะฐัะธั Prometheus ะธ Grafana. |
| **Node Exporter** | ะะณะตะฝั ะดะปั ัะฑะพัะฐ ะผะตััะธะบ Linux. |

---

## ๐ ะัััััะน ััะฐัั

### 1. ะะพะดะณะพัะพะฒะบะฐ ะพะบััะถะตะฝะธั

ะะฐะผ ะฟะพะฝะฐะดะพะฑัััั ัััะฐะฝะพะฒะปะตะฝะฝัะต:
*   [Terraform](https://learn.hashicorp.com/tutorials/terraform/install-cli)
*   [Ansible](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html)
*   [Yandex Cloud CLI](https://cloud.yandex.ru/ru/docs/cli/quickstart) (ะดะปั ัะพะทะดะฐะฝะธั ัะพะบะตะฝะฐ)
*   SSH-ะบะปััะธ (`id_ed25519` ะธะปะธ `id_rsa`)

### 2. ะะฐัััะพะนะบะฐ Terraform Mirror (ะะฐะถะฝะพ ะดะปั ะะค)

ะงัะพะฑั Terraform ะผะพะณ ัะบะฐัะฐัั ะฟัะพะฒะฐะนะดะตัั ะธะท ะะพััะธะธ, ะฝะฐัััะพะนัะต ะทะตัะบะฐะปะฐ:

```bash
nano ~/.terraformrc
```

ะััะฐะฒััะต ัะปะตะดัััะตะต ัะพะดะตัะถะธะผะพะต ะธ ัะพััะฐะฝะธัะต (`Ctrl+O`, `Enter`, `Ctrl+X`):

```hcl
provider_installation {
  network_mirror {
    url = "https://terraform-mirror.yandexcloud.net/"
    include = ["registry.terraform.io/*/*"]
  }
  direct {
    exclude = ["registry.terraform.io/*/*"]
  }
}
```

### 3. ะะฐัััะพะนะบะฐ Yandex Cloud CLI ะธ ะฐะฒัะพัะธะทะฐัะธั

ะะฒัะพัะธะทัะนัะตัั ะฒ ะพะฑะปะฐะบะต ะธ ัะพะทะดะฐะนัะต OAuth ัะพะบะตะฝ (ะฒัะตะผั ะถะธะทะฝะธ ัะพะบะตะฝะฐ ะพะณัะฐะฝะธัะตะฝะพ, ะดะปั ะฟัะพะดะฐะบัะตะฝะฐ ะปัััะต ะธัะฟะพะปัะทะพะฒะฐัั Service Account):

```bash
# ะะฝะธัะธะฐะปะธะทะฐัะธั Yandex CLI (ะฟะพััะตะฑัะตั ะฑัะฐัะทะตั)
yc init

# ะกะพะทะดะฐะฝะธะต ะฒัะตะผะตะฝะฝะพะณะพ ัะพะบะตะฝะฐ
export YC_TOKEN=$(yc iam create-token)
```

### 4. ะะฐะทะฒะตัััะฒะฐะฝะธะต ะธะฝััะฐััััะบัััั (Terraform)

ะะตัะตะนะดะธัะต ะฒ ะฟะฐะฟะบั ั Terraform ะธ ัะพะทะดะฐะนัะต ะบะพะฝัะธะณััะฐัะธั:

```bash
cd terraform

# ะะะะะ: ะะตัะตะด ะทะฐะฟััะบะพะผ ัะฑะตะดะธัะตัั, ััะพ ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะดะพัััะฟะฝั
echo $YC_TOKEN # ะะพะปะถะตะฝ ะฒัะฒะตััะธ ัะพะบะตะฝ

# ะะฝะธัะธะฐะปะธะทะฐัะธั (ัะบะฐัะธะฒะฐะฝะธะต ะฟัะพะฒะฐะนะดะตัะพะฒ ัะตัะตะท ะทะตัะบะฐะปะพ)
terraform init

# ะัะพะฒะตัะบะฐ ะฟะปะฐะฝะฐ
terraform plan

# ะกะพะทะดะฐะฝะธะต ัะตััััะพะฒ
terraform apply
```
*ะะพัะปะต ะทะฐะฒะตััะตะฝะธั Terraform ะฒัะฒะตะดะตั ะฟัะฑะปะธัะฝัะต IP ะฐะดัะตัะฐ ัะตัะฒะตัะพะฒ. ะะฐะฟะธัะธัะต ะธั!*

### 5. ะะฐัััะพะนะบะฐ Ansible Inventory

ะกะพะทะดะฐะนัะต ัะฐะนะป ะธะฝะฒะตะฝัะฐัั ะฝะฐ ะพัะฝะพะฒะต ะฟัะธะผะตัะฐ ะธ ะฒััะฐะฒััะต ะฟะพะปััะตะฝะฝัะต IP ะฐะดัะตัะฐ:

```bash
cd ../ansible
cp inventory.ini.example inventory.ini
nano inventory.ini
```

ะัะธะผะตั ะทะฐะฟะพะปะฝะตะฝะธั (ะทะฐะผะตะฝะธัะต IP ะฝะฐ ัะฒะพะธ):
```ini
[monitoring]
monitoring-server ansible_host=1.2.3.4

[monitoring:vars]
grafana_admin_user=admin
grafana_admin_password=super_secret

[clients]
client-server ansible_host=1.2.3.5

[all:vars]
ansible_python_interpreter=/usr/bin/python3
```

### 6. ะะฐะฟััะบ ะบะพะฝัะธะณััะฐัะธะธ (Ansible)

Ansible ะฐะฒัะพะผะฐัะธัะตัะบะธ ัััะฐะฝะพะฒะธั Docker, Node Exporter, Prometheus ะธ Grafana.

```bash
ansible-playbook -i inventory.ini playbook.yml
```

---

## ๐ ะัะพะฒะตัะบะฐ ัะตะทัะปััะฐัะฐ

ะะพัะปะต ััะฟะตัะฝะพะณะพ ะฒัะฟะพะปะฝะตะฝะธั Ansible:

1.  **Grafana**: ะัะบัะพะนัะต ะฒ ะฑัะฐัะทะตัะต `http://<MONITORING_IP>:3000`.
    *   ะะพะณะธะฝ/ะะฐัะพะปั: ัะพั, ััะพ ะฒั ัะบะฐะทะฐะปะธ ะฒ `inventory.ini` (ะฟะพ ัะผะพะปัะฐะฝะธั `admin` / `super_secret_password_123`).
    *   **Datasource**: Grafana ะฟะพะดะบะปััะธััั ะบ Prometheus ะฐะฒัะพะผะฐัะธัะตัะบะธ.
2.  **Prometheus UI**: ะะพัััะฟะตะฝ ะฟะพ `http://localhost:9090` (ะตัะปะธ ะฒั ะฝะฐ ัะฐะผะพะผ ัะตัะฒะตัะต) ะธะปะธ ัะตัะตะท SSH-ััะฝะฝะตะปั. ะััะผะพะน ะดะพัััะฟ ะธะทะฒะฝะต ะทะฐะบััั ะฟะพ ัะพะพะฑัะฐะถะตะฝะธัะผ ะฑะตะทะพะฟะฐัะฝะพััะธ (bind to 127.0.0.1).

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
.
โโโ .github/                 # GitHub Actions CI/CD ะฟะฐะนะฟะปะฐะนะฝั
โ   โโโ workflows/
โโโ ansible/                 # Ansible ะบะพะฝัะธะณััะฐัะธะธ
โ   โโโ roles/               # ะะพะปะธ (client, monitoring)
โ   โ   โโโ client/          # ะะฐัััะพะนะบะฐ Node Exporter ะธ Docker
โ   โ   โโโ monitoring/      # ะะฐัััะพะนะบะฐ Prometheus ะธ Grafana
โ   โโโ ansible.cfg          # ะะพะฝัะธะณััะฐัะธั Ansible
โ   โโโ inventory.ini        # ะะฝะฒะตะฝัะฐัั ัะตัะฒะตัะพะฒ (IP ะฐะดัะตัะฐ)
โ   โโโ playbook.yml         # ะะปะฐะฒะฝัะน ะฟะปะตะนะฑัะบ
โโโ terraform/               # ะะพะด ะธะฝััะฐััััะบัััั
โ   โโโ main.tf              # ะัะฝะพะฒะฝะพะน ะบะพะฝัะธะณ
โ   โโโ outputs.tf           # ะััะพะดะฝัะต ะทะฝะฐัะตะฝะธั (IP)
โ   โโโ provider.tf          # ะัะพะฒะฐะนะดะตั Yandex Cloud
โ   โโโ variables.tf         # ะะตัะตะผะตะฝะฝัะต
โโโ README.md
```

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั

1.  **ะกะตะบัะตัั**: `.env` ะธ `inventory.ini` ะดะพะฑะฐะฒะปะตะฝั ะฒ `.gitignore` ะธ ะฝะต ะฟะพะฟะฐะดะฐัั ะฒ ัะตะฟะพะทะธัะพัะธะน.
2.  **SSH**: ะะพัััะฟ ะพัััะตััะฒะปัะตััั ัะพะปัะบะพ ะฟะพ ะบะปััะฐะผ.
3.  **Network**: Prometheus ัะปััะฐะตั ัะพะปัะบะพ ะฝะฐ `127.0.0.1` (localhost), ััะพะฑั ะฝะต exposing ะผะตััะธะบะธ ะฒะพ ะฒะฝะตัะฝะธะน ะผะธั. ะะพัััะฟ ะบ Grafana ะพะณัะฐะฝะธัะตะฝ ัะฐะนัะฒะพะปะพะผ (ะฟะพัั 3000).

